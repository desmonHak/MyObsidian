[https://learn.microsoft.com/es-es/cpp/cpp/argument-passing-and-naming-conventions?view=msvc-170](https://learn.microsoft.com/es-es/cpp/cpp/argument-passing-and-naming-conventions?view=msvc-170)

Los compiladores de Microsoft C++ permiten especificar convenciones para pasar argumentos y valores devueltos entre funciones y llamadores. No todas las convenciones están disponibles en todas las plataformas compatibles y algunas convenciones utilizan implementaciones específicas de la plataforma. En la mayoría de los casos, se omiten palabras clave o modificadores de compilador que especifican una convención no compatible en una plataforma concreta y se usa la convención predeterminada de la plataforma.

En plataformas x86, todos los argumentos se amplían a 32 bits cuando se pasan. Los valores devueltos también se amplían a 32 bits y se devuelven en el registro EAX, salvo las estructuras de 8 bytes, que se devuelven en el par de registros EDX:EAX. Las estructuras de mayor tamaño se devuelven en el registro EAX como punteros a estructuras de devolución ocultas. Los parámetros se insertan en la pila de derecha a izquierda. Las estructuras distintas de POD no se devolverán en registros.

El compilador genera código de prólogo y epílogo para guardar y restaurar los registros ESI, EDI, EBX y EBP, si se usan en la función.

| Palabra clave                                                                      | Limpieza de la pila | Paso de parámetros                                                                             |
| ---------------------------------------------------------------------------------- | ------------------- | ---------------------------------------------------------------------------------------------- |
| [__cdecl](https://learn.microsoft.com/es-es/cpp/cpp/cdecl?view=msvc-170)           | Autor de llamada    | Inserta parámetros en la pila, en orden inverso (de derecha a izquierda)                       |
| [__clrcall](https://learn.microsoft.com/es-es/cpp/cpp/clrcall?view=msvc-170)       | N/D                 | Carga parámetros en la pila de expresiones CLR en orden (de izquierda a derecha).              |
| [__stdcall](https://learn.microsoft.com/es-es/cpp/cpp/stdcall?view=msvc-170)       | Destinatario        | Inserta parámetros en la pila, en orden inverso (de derecha a izquierda)                       |
| [__fastcall](https://learn.microsoft.com/es-es/cpp/cpp/fastcall?view=msvc-170)     | Destinatario        | Almacenado en los registros y luego insertado en la pila                                       |
| [__thiscall](https://learn.microsoft.com/es-es/cpp/cpp/thiscall?view=msvc-170)     | Destinatario        | Insertado en la pila; puntero **`this`** almacenado en ECX                                     |
| [__vectorcall](https://learn.microsoft.com/es-es/cpp/cpp/vectorcall?view=msvc-170) | Destinatario        | Almacenado en registros y luego insertado en la pila en orden inverso (de derecha a izquierda) |

## Lista de convenciones de llamada x86

Esta es una lista de las convenciones de llamada de x86.[1](https://en.wikipedia.org/wiki/X86_calling_conventions#cite_note-fog-1) Estas son convenciones pensadas principalmente para compiladores C/C++ (especialmente la parte de ``64 bits`` a continuación), y por lo tanto en gran medida casos especiales. Otros lenguajes pueden utilizar otros formatos y convenciones en sus implementaciones.

| Archi­tecture                                                                                         | Name                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Operating system, compiler                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | Parameters                           |         | Stack cleanup                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Notes                                                                                                                                                                                                                                                                                                |
| ----------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------ | ------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Registers                                                                                             | Stack order                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                                      |         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                                                                                                                                                      |
| [8086](https://en.wikipedia.org/wiki/Intel_8086 "Intel 8086")                                         | cdecl                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                                      | RTL (C) | Caller                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                      |
| [Pascal](https://en.wikipedia.org/wiki/Pascal_(programming_language) "Pascal (programming language)") |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | LTR (Pascal)                         | Callee  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                                                                                                                                                      |
| fastcall (non-member)                                                                                 | Microsoft                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | AX, DX, BX                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | LTR (Pascal)                         | Callee  | Return pointer in BX.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                                                                                                                      |
| fastcall (member function)                                                                            | Microsoft                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | AX, DX                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | LTR (Pascal)                         | Callee  | `this` on stack low address. Return pointer in AX.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |                                                                                                                                                                                                                                                                                                      |
| fastcall                                                                                              | [Turbo C](https://en.wikipedia.org/wiki/Turbo_C "Turbo C")[29](https://en.wikipedia.org/wiki/X86_calling_conventions#cite_note-borland-29)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | AX, DX, BX                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | LTR (Pascal)                         | Callee  | `this` on stack low address. Return pointer on stack high address.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |                                                                                                                                                                                                                                                                                                      |
|                                                                                                       | [Watcom](https://en.wikipedia.org/wiki/Watcom "Watcom")                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | AX, DX, BX, CX                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | RTL (C)                              | Callee  | Return pointer in SI.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                                                                                                                      |
| [IA-32](https://en.wikipedia.org/wiki/IA-32 "IA-32")                                                  | cdecl                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Unix-like ([GCC](https://en.wikipedia.org/wiki/GNU_Compiler_Collection "GNU Compiler Collection"))                                                                                                                                                                                                                                                                                                                                                                                            |                                      | RTL (C) | Caller                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | When returning struct/class, the calling code allocates space and passes a pointer to this space via a hidden parameter on the stack. The called function writes the return value to this address.<br><br>Stack aligned on 16-byte boundary due to a bug.                                            |
| cdecl                                                                                                 | Microsoft                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | RTL (C)                              | Caller  | When returning struct/class,<br><br>- [Plain old data](https://en.wikipedia.org/wiki/Plain_old_data "Plain old data") (POD) return values 32 bits or smaller are in the EAX register<br>- POD return values 33–64 bits in size are returned via the EAX:EDX registers.<br>- Non-POD return values or values larger than 64-bits, the calling code will allocate space and passes a pointer to this space via a hidden parameter on the stack. The called function writes the return value to this address.<br><br>Stack aligned on 4-byte boundary. |                                                                                                                                                                                                                                                                                                      |
| stdcall                                                                                               | Microsoft                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | RTL (C)                              | Callee  | Also supported by GCC.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                      |
| fastcall                                                                                              | Microsoft                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | ECX, EDX                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | RTL (C)                              | Callee  | Return pointer on stack if not member function. Also supported by GCC.                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                      |
| register                                                                                              | [Delphi](https://en.wikipedia.org/wiki/Delphi_(software) "Delphi (software)"), [Free Pascal](https://en.wikipedia.org/wiki/Free_Pascal "Free Pascal"), [Linux](https://en.wikipedia.org/wiki/Linux "Linux")[30](https://en.wikipedia.org/wiki/X86_calling_conventions#cite_note-30)                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | EAX, EDX, ECX                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | LTR (Pascal)                         | Callee  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                                                                                                                                                      |
| thiscall                                                                                              | [Windows](https://en.wikipedia.org/wiki/Windows "Windows") ([Microsoft Visual C++](https://en.wikipedia.org/wiki/Microsoft_Visual_C%2B%2B "Microsoft Visual C++"))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ECX                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | RTL (C)                              | Callee  | Default for member functions.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                                                                                                      |
| vectorcall                                                                                            | [Windows](https://en.wikipedia.org/wiki/Windows "Windows") ([Microsoft Visual C++](https://en.wikipedia.org/wiki/Microsoft_Visual_C%2B%2B "Microsoft Visual C++"))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | ECX, EDX, [XY]MM0–5                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | RTL (C)                              | Callee  | Extended from fastcall. Also supported by ICC and Clang.[11](https://en.wikipedia.org/wiki/X86_calling_conventions#cite_note-vectorcall-11)                                                                                                                                                                                                                                                                                                                                                                                                         |                                                                                                                                                                                                                                                                                                      |
|                                                                                                       | Watcom compiler                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | EAX, EDX, EBX, ECX                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | RTL (C)                              | Callee  | Return pointer in ESI.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |                                                                                                                                                                                                                                                                                                      |
| [x86-64](https://en.wikipedia.org/wiki/X86-64 "X86-64")                                               | Microsoft x64 calling convention[21](https://en.wikipedia.org/wiki/X86_calling_conventions#cite_note-ms-21)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | [Windows](https://en.wikipedia.org/wiki/Windows "Windows") ([Microsoft Visual C++](https://en.wikipedia.org/wiki/Microsoft_Visual_C%2B%2B "Microsoft Visual C++"), [GCC](https://en.wikipedia.org/wiki/GNU_Compiler_Collection "GNU Compiler Collection"), [Intel C++ Compiler](https://en.wikipedia.org/wiki/Intel_C%2B%2B_Compiler "Intel C++ Compiler"), [Delphi](https://en.wikipedia.org/wiki/Delphi_(software) "Delphi (software)")), [UEFI](https://en.wikipedia.org/wiki/UEFI "UEFI") | RCX/XMM0, RDX/XMM1, R8/XMM2, R9/XMM3 | RTL (C) | Caller                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Stack aligned on 16 bytes. 32 bytes shadow space on stack. The specified 8 registers can only be used for parameters 1 through 4. For C++ classes, the hidden `this` parameter is the first parameter, and is passed in RCX.[31](https://en.wikipedia.org/wiki/X86_calling_conventions#cite_note-31) |
| vectorcall                                                                                            | [Windows](https://en.wikipedia.org/wiki/Windows "Windows") ([Microsoft Visual C++](https://en.wikipedia.org/wiki/Microsoft_Visual_C%2B%2B "Microsoft Visual C++"), Clang, ICC)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | RCX/[XY]MM0, RDX/[XY]MM1, R8/[XY]MM2, R9/[XY]MM3 + [XY]MM4–5                                                                                                                                                                                                                                                                                                                                                                                                                                  | RTL (C)                              | Caller  | Extended from MS x64.[11](https://en.wikipedia.org/wiki/X86_calling_conventions#cite_note-vectorcall-11)                                                                                                                                                                                                                                                                                                                                                                                                                                            |                                                                                                                                                                                                                                                                                                      |
| System V AMD64 ABI[28](https://en.wikipedia.org/wiki/X86_calling_conventions#cite_note-AMD-28)        | [Solaris](https://en.wikipedia.org/wiki/Oracle_Solaris "Oracle Solaris"), [Linux](https://en.wikipedia.org/wiki/Linux "Linux"),[32](https://en.wikipedia.org/wiki/X86_calling_conventions#cite_note-32) [BSD](https://en.wikipedia.org/wiki/Berkeley_Software_Distribution "Berkeley Software Distribution"), [macOS](https://en.wikipedia.org/wiki/MacOS "MacOS"), [OpenVMS](https://en.wikipedia.org/wiki/OpenVMS "OpenVMS") ([GCC](https://en.wikipedia.org/wiki/GNU_Compiler_Collection "GNU Compiler Collection"), [Intel C++ Compiler](https://en.wikipedia.org/wiki/Intel_C%2B%2B_Compiler "Intel C++ Compiler"), [Clang](https://en.wikipedia.org/wiki/Clang "Clang"), [Delphi](https://en.wikipedia.org/wiki/Delphi_(software) "Delphi (software)")) | RDI, RSI, RDX, RCX, R8, R9, [XYZ]MM0–7                                                                                                                                                                                                                                                                                                                                                                                                                                                        | RTL (C)                              | Caller  | Stack aligned on 16 bytes boundary. 128 bytes [red zone](https://en.wikipedia.org/wiki/Red_zone_(computing) "Red zone (computing)") below stack. The kernel interface uses RDI, RSI, RDX, R10, R8 and R9. In C++, `this` is the first parameter.                                                                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                                                      |

# Para 16bits:
En 16bits la convenciones mas usadas son [[__cdecl]], [[Pascal-calling-convention]] y [[Watcom register]]
# Para 32bits:
En 32bits la convenciones mas usadas son [[__cdecl]], [[__stdcall]], [[__fastcall]]. [[__regcall]], [[__thiscall]], [[__vectorcall]] y [[Watcom register]]
# Para 64bits:
En 64bits la convenciones mas usadas son [[__msfastcall]] tambien llamada [[__fastcall]], [[__vectorcall]] y [[System-V-AMD64-ABI]]

[https://learn.microsoft.com/es-es/cpp/build/x64-calling-convention?view=msvc-170](https://learn.microsoft.com/es-es/cpp/build/x64-calling-convention?view=msvc-170)

En esta sección se describen los procesos y convenciones estándar que usa una función (autor de la llamada) para realizar llamadas en otra función (destinatario) en código x64.

Para obtener más información sobre la convención de `__vectorcall` llamada, consulte [__vectorcall](https://learn.microsoft.com/es-es/cpp/cpp/vectorcall?view=msvc-170)
## Valor predeterminado de la convención de llamada

De forma predeterminada, la interfaz binaria de aplicación (ABI) x64 utiliza una Convención de llamada rápida de cuatro registros. Se asigna espacio en la pila de llamadas como un almacén de propiedades reemplazadas para que los destinatarios puedan guardar esos registros.

Hay una correspondencia uno a uno estricta entre los argumentos de una llamada de función y los registros utilizados para esos argumentos. Cualquier argumento que no se ajuste a 8 bytes, o que no sea 1, 2, 4 u 8 bytes, debe pasarse por referencia. Un único argumento nunca se distribuye entre varios registros.

La pila de registro x87 no se utiliza. La puede usar el destinatario, pero considérela volátil en las funciones de llamada. Todas las operaciones de punto flotante se realizan mediante los 16 registros de XMM.

Los argumentos de entero se pasan en los registros RCX, RDX, R8 y R9. Los argumentos de punto flotante se pasan en XMM0L, XMM1L, XMM2L y XMM3L. Los argumentos de 16 bytes se pasan por referencia. El paso de parámetros se describe en detalle en la sección [Paso de parámetros](https://learn.microsoft.com/es-es/cpp/build/x64-calling-convention?view=msvc-170#parameter-passing). Estos registros, y RAX, R10, R11, XMM4 y XMM5, se consideran _volátiles_ o, potencialmente, los cambia un destinatario en la devolución. El uso del registro se documenta en detalle en [registro de uso de x64](https://learn.microsoft.com/es-es/cpp/build/x64-software-conventions?view=msvc-170#x64-register-usage) y [registros guardados de llamador o destinatario](https://learn.microsoft.com/es-es/cpp/build/x64-calling-convention?view=msvc-170#callercallee-saved-registers).

En el caso de las funciones con prototipo, todos los argumentos se convierten en los tipos de destinatarios esperados antes de pasar. El autor de la llamada es el responsable de asignar espacio para los parámetros del destinatario. Siempre debe asignar espacio suficiente para almacenar cuatro parámetros de registro, aunque el destinatario no use tantos. Esta convención simplifica la compatibilidad con las funciones de lenguaje de C sin prototipo y las funciones vararg C/C++. En el caso de las funciones vararg o sin prototipo, los valores de punto flotante se deben duplicar en el registro de uso general correspondiente. Cualquier parámetro adicional a los cuatro primeros se deberá almacenar en la pila, después del almacén de propiedades reemplazadas antes de la llamada. Los detalles de la función vararg se pueden encontrar en [Varargs](https://learn.microsoft.com/es-es/cpp/build/x64-calling-convention?view=msvc-170#varargs). La información de funciones sin prototipo se detalla en [Funciones sin prototipo](https://learn.microsoft.com/es-es/cpp/build/x64-calling-convention?view=msvc-170#unprototyped-functions).
## Alineación
La mayoría de las estructuras se alinean con su alineación natural. Las excepciones principales son el puntero de pila y la memoria `malloc` o `alloca`, que se alinean a 16 bytes para un mejor rendimiento. Las alineaciones superiores a 16 bytes se deberán realizar manualmente. Como 16 bytes es un tamaño de alineación común para las operaciones XMM, este valor debería funcionar para la mayoría del código. Para obtener más información sobre el diseño y la alineación de la estructura, [el tipo x64 y el diseño de almacenamiento](https://learn.microsoft.com/es-es/cpp/build/x64-software-conventions?view=msvc-170#x64-type-and-storage-layout). Para obtener información sobre el diseño de pila, vea [Uso de las pilas x64](https://learn.microsoft.com/es-es/cpp/build/stack-usage?view=msvc-170).

## Capacidad de desenredado
Las funciones de hoja son funciones que no cambian ningún registro no volátil. Las funciones que no son de hoja pueden cambiar el RSP no volátil, por ejemplo, mediante una llamada a una función. O bien, podrían cambiar el RSP asignando espacio de pila adicional para las variables locales. Para recuperar los registros no volátiles al manipular una excepción, las funciones que no son de hoja se anotan con los datos estáticos. Los datos describen cómo desenredar correctamente la función en una instrucción arbitraria. Estos datos se almacenan como _pdata_ o datos de procedimiento, que a su vez hacen referencia a _xdata_, los datos de control de excepciones. Los xdata contienen la información de desenredado y pueden apuntar a un pdata adicional o a una función de controlador de excepciones.

Los prólogos y epílogos están muy restringidos, de tal forma que se puedan describir correctamente en xdata. El puntero de pila debe permanecer alineado a 16 bytes en cualquier región de código que no forme parte de un epílogo o prólogo, excepto en las funciones de hoja. Las funciones de hoja se pueden desenredar simplemente simulando una devolución, por lo que no se requieren pdata ni xdata. Para obtener más información sobre la estructura adecuada de los prólogos y epílogos de función, vea [Prólogo y epílogo x64](https://learn.microsoft.com/es-es/cpp/build/prolog-and-epilog?view=msvc-170). Para obtener más información sobre el control de excepciones, así como del control de excepciones y el desenredado de pdata y xdata, vea [Control de excepciones x64](https://learn.microsoft.com/es-es/cpp/build/exception-handling-x64?view=msvc-170).

## Paso de parámetros
De forma predeterminada, la convención de llamada x64 pasa los cuatro primeros argumentos a una función en los registros. Los registros que se utilizan para estos argumentos dependen de la posición y el tipo del argumento. Los argumentos restantes se insertan en la pila de derecha a izquierda.

Los valores enteros de las cuatro posiciones más a la izquierda se pasan de izquierda a derecha en RCX, RDX, R8 y R9, respectivamente. Los siguientes argumentos (del quinto en adelante) se pasan en la pila como se ha descrito anteriormente. Todos los argumentos de enteros de los registros están justificados a la derecha, por lo que el destinatario puede ignorar los bits superiores del registro y acceder solo a la parte del registro necesaria.

Los argumentos de punto flotante y de precisión doble de los cuatro primeros parámetros se pasan en XMM0-XMM3, en función de la posición. Los valores de punto flotante solo se colocan en los registros de enteros RCX, RDX, R8 y R9 cuando hay argumentos varargs. Para obtener información detallada, vea [Varargs](https://learn.microsoft.com/es-es/cpp/build/x64-calling-convention?view=msvc-170#varargs). Del mismo modo, los registros de XMM0-XMM3 se ignoran cuando el argumento correspondiente es un tipo entero o de puntero.

Las cadenas, las matrices y los tipos [`__m128`](https://learn.microsoft.com/es-es/cpp/cpp/m128?view=msvc-170) nunca se pasan por valor inmediato. En su lugar, se pasa un puntero a la memoria que asigna el autor de la llamada. Las estructuras y uniones de 8, 16, 32 o 64 bits, así como los tipos **`__m64`**, se pasan como si fueran enteros del mismo tamaño. Las estructuras o uniones de otros tamaños se pasan como un puntero a la memoria que asigna el autor de la llamada. Para estos tipos de agregado que se pasan como puntero, incluido **`__m128`**, la memoria temporal asignada por el autor de la llamada debe tener una alineación de 16 bytes.

Las funciones intrínsecas que no asignan espacio de pila y no llaman a otras funciones, a veces usan otros registros volátiles para pasar argumentos de registro adicionales. Esta optimización se realiza mediante el enlace estricto entre el compilador y la implementación de la función intrínseca.

El destinatario es el responsable de volcar los parámetros de registro en su espacio de propiedades reemplazadas, en caso necesario.

En la tabla siguiente se resume cómo se pasan los parámetros, por tipo y posición desde la izquierda:

|Parameter type (Tipo de parámetro)|quinto y posteriores|cuarto|Tercero|second|extremo izquierdo|
|---|---|---|---|---|---|
|punto flotante|stack|XMM3|XMM2|XMM1|XMM0|
|integer|stack|R9|R8|RDX|RCX|
|Agregados (de 8, 16, 32 o 64 bits) y **`__m64`**|stack|R9|R8|RDX|RCX|
|otros agregados como punteros|stack|R9|R8|RDX|RCX|
|**`__m128`**, como puntero|stack|R9|R8|RDX|RCX|
### Ejemplo 1 de paso de argumentos: todos los enteros
```c
func1(int a, int b, int c, int d, int e, int f);
// a in RCX, b in RDX, c in R8, d in R9, f then e pushed on stack
```
### Ejemplo 2 de paso de argumentos: todos los flotantes
```c
func2(float a, double b, float c, double d, float e, float f);
// a in XMM0, b in XMM1, c in XMM2, d in XMM3, f then e pushed on stack
```
### Ejemplo 3 de paso de argumentos: los enteros y los flotantes combinados
```c
func3(int a, double b, int c, float d, int e, float f);
// a in RCX, b in XMM1, c in R8, d in XMM3, f then e pushed on stack
```
### Ejemplo 4 de paso de argumentos: `__m64`, `__m128` y los agregados
```c
func4(__m64 a, __m128 b, struct c, float d, __m128 e, __m128 f);
// a in RCX, ptr to b in RDX, ptr to c in R8, d in XMM3,
// ptr to f pushed on stack, then ptr to e pushed on stack
```
##   Varargs
Si los parámetros se pasan a través de varargs (por ejemplo, argumentos de puntos suspensivos), se aplica la convención normal de paso de los parámetros de registro. Esta convención incluye el volcado del quinto argumento y los siguientes en la pila. Es responsabilidad del destinatario volcar los argumentos que tienen su dirección tomada. Solo para los valores de punto flotante, tanto el registro de entero como el de punto flotante deben contener el valor, en caso de que el destinatario espere el valor de los registros enteros.
## Funciones sin prototipo
En el caso de las funciones sin prototipo completo, el autor de la llamada pasa valores enteros como enteros y valores de punto flotante como precisión doble. Solo para los valores de punto flotante, tanto el registro de entero como el de punto flotante contienen el valor flotante, en caso de que el destinatario espere el valor de los registros enteros.
```c
func1();
func2() {   // RCX = 2, RDX = XMM1 = 1.0, and R8 = 7
   func1(2, 1.0, 7);
}
```

## Valores devueltos
Valor escalar devuelto que puede caber en 64 bits, incluido el tipo **`__m64`**, se devuelve mediante RAX. Los tipos no escalares, incluidos los tipos float, doubles y vectores, como [`__m128`](https://learn.microsoft.com/es-es/cpp/cpp/m128?view=msvc-170), [`__m128i`](https://learn.microsoft.com/es-es/cpp/cpp/m128i?view=msvc-170), [`__m128d`](https://learn.microsoft.com/es-es/cpp/cpp/m128d?view=msvc-170) se devuelven en XMM0. El estado de bits no usados en el valor devuelto en RAX o XMM0 es indefinido.

Se pueden devolver tipos definidos por el usuario por valor de funciones globales y funciones miembro estáticas. Para devolver un tipo definido por el usuario por valor en RAX, debe tener una longitud de 1, 2, 4, 8, 16, 32 o 64 bits. Además, no debe tener ningún operador de asignación de copia, destructor ni constructor definidos por el usuario. No puede tener miembros de datos no estáticos privados o protegidos ni miembros de datos no estáticos de tipo de referencia. No puede tener funciones virtuales ni clases base. Solo puede tener miembros de datos que también cumplan estos requisitos. (Esta definición es básicamente la misma que un tipo POD de C++03. Dado que la definición ha cambiado en el estándar C++11, no se recomienda usar `std::is_pod` para esta prueba). De lo contrario, el autor de la llamada debe asignar memoria para el valor devuelto y pasarle un puntero como primer argumento. Los argumentos restantes se desplazan entonces un argumento a la derecha. El destinatario debe devolver el mismo puntero en RAX.

Estos ejemplos muestran cómo se pasan los parámetros y valores devueltos para las funciones con las declaraciones especificadas:

### Ejemplo 1 de valor devuelto: resultado de 64 bits
```c
__int64 func1(int a, float b, int c, int d, int e);
// Caller passes a in RCX, b in XMM1, c in R8, d in R9, e pushed on stack,
// callee returns __int64 result in RAX.
```
### Ejemplo 2 de valor devuelto: resultado de 128 bits
```c
__m128 func2(float a, double b, int c, __m64 d);
// Caller passes a in XMM0, b in XMM1, c in R8, d in R9,
// callee returns __m128 result in XMM0.
```
### Ejemplo 3 de valor devuelto: resultado de tipo de usuario por puntero
```c
struct Struct1 {
   int j, k, l;    // Struct1 exceeds 64 bits.
};
Struct1 func3(int a, double b, int c, float d);
// Caller allocates memory for Struct1 returned and passes pointer in RCX,
// a in RDX, b in XMM2, c in R9, d pushed on the stack;
// callee returns pointer to Struct1 result in RAX.
```
### Ejemplo 4 de valor devuelto: resultado de tipo de usuario por valor
```c
struct Struct2 {
   int j, k;    // Struct2 fits in 64 bits, and meets requirements for return by value.
};
Struct2 func4(int a, double b, int c, float d);
// Caller passes a in RCX, b in XMM1, c in R8, and d in XMM3;
// callee returns Struct2 result by value in RAX.
```

## Registros guardados del autor y el destinatario de la llamada
ABI x64 considera volátiles los registros RAX, RCX, RDX, R8, R9, R10 y R11, así como los comprendidos entre el XMM0 y el XMM5. Cuando están presentes, las partes superiores de los registros comprendidos entre el YMM0 y el YMM15 y entre el ZMM0 y el ZMM15 son volátiles. En AVX512VL, también lo son los registros ZMM, YMM y XMM (del 16 al 31). Cuando hay compatibilidad con AMX, los registros de icono de TMM son volátiles. Considere destruidos los registros volátiles en las llamadas a funciones, a menos que lo contrario sea demostrable de forma segura mediante un análisis, como la optimización de todo el programa.

ABI x64 considera no volátiles los registros RBX, RBP, RDI, RSI, RSP, R12, R13, R14 y R15, así como los comprendidos entre el XMM6 y el XMM15. Deben guardarse y restaurarse mediante una función que los use.
## Punteros de función
Los punteros de función son simplemente punteros a la etiqueta de la función respectiva. No hay ningún requisito de tabla de contenido (TOC) para los punteros de función.

## Compatibilidad del código antiguo con puntos flotantes
Los registros de la pila de punto flotante y MMX (MM0-MM7/ST0-ST7) se conservan en los cambios de contexto. No hay ninguna convención de llamada explícita para estos registros. El uso de estos registros está estrictamente prohibido en el código del modo kernel.

## FPCSR
El estado del registro también incluye la palabra de control de FPU x87. La convención de llamada dicta este registro para que sea no volátil.

El registro de palabra de control de FPU x87 se establece mediante los siguientes valores estándar al inicio de la ejecución del programa:

|Register[bits]|Configuración|
|---|---|
|FPCSR[0:6]|Máscaras de excepción, todos los 1 (todas las excepciones enmascaradas)|
|FPCSR[7]|Reservado: 0|
|FPCSR[8:9]|Control de precisión: 10B (precisión doble)|
|FPCSR[10:11]|Control de redondeo: 0 (redondeo al valor más próximo)|
|FPCSR[12]|Control de infinito: 0 (no utilizado)|

Un destinatario que modifique cualquiera de los campos en FPCSR debe restaurarlos antes de devolverlos al autor de la llamada. Además, un autor de llamada que haya modificado cualquiera de estos campos debe restaurarlos a sus valores estándar antes de invocar a un destinatario, a menos que el destinatario espere los valores modificados por contrato.

Existen dos excepciones a las reglas sobre la no volatilidad de las marcas de control:

- En funciones en las que el propósito documentado de la función determinada sea modificar las marcas FPCSR no volátiles.
    
- Cuando sea correcto de un modo demostrable que la infracción de estas reglas dé como resultado un programa que se comporte igual que un programa que no infringe las reglas, por ejemplo, a través del análisis de todo el programa.

## MXCSR
El estado del registro también incluye MXCSR. La convención de llamada divide este registro en una parte volátil y una parte no volátil. La parte volátil consta de las seis marcas de estado, en MXCSR[0:5], mientras que el resto del registro, MXCSR[6:15], se considera no volátil.

La parte no volátil se establece en los siguientes valores estándar al inicio de la ejecución del programa:

|Register[bits]|Configuración|
|---|---|
|MXCSR[6]|Los desnormalizados son ceros: 0|
|MXCSR[7:12]|Máscaras de excepción, todos los 1 (todas las excepciones enmascaradas)|
|MXCSR[13:14]|Control de redondeo: 0 (redondeo al valor más próximo)|
|MXCSR[15]|Vaciado en cero para desbordamiento enmascarado: 0 (desactivado)|

Un destinatario que modifique cualquiera de los campos no volátiles en MXCSR debe restaurarlos antes de devolverlos al autor de la llamada. Además, un autor de llamada que haya modificado cualquiera de estos campos debe restaurarlos a sus valores estándar antes de invocar a un destinatario, a menos que el destinatario espere los valores modificados por contrato.

Existen dos excepciones a las reglas sobre la no volatilidad de las marcas de control:

- En funciones en las que el propósito documentado de la función determinada sea modificar las marcas MXCSR no volátiles.
    
- Cuando sea correcto de un modo demostrable que la infracción de estas reglas dé como resultado un programa que se comporte igual que un programa que no infringe las reglas, por ejemplo, a través del análisis de todo el programa.
    

No realice suposiciones sobre el estado de la parte volátil del registro MXCSR a través de un límite de función, a menos que la documentación de la función lo describa explícitamente.
## setjmp/longjmp

Al incluir [[setjmpex.h]] o [[setjmp.h]], todas las llamadas a [`setjmp`](https://learn.microsoft.com/es-es/cpp/c-runtime-library/reference/setjmp?view=msvc-170) o [`longjmp`](https://learn.microsoft.com/es-es/cpp/c-runtime-library/reference/longjmp?view=msvc-170) dan como resultado un desenredo que invoca destructores y llamadas a **`__finally`**. Este comportamiento difiere de x86, donde incluir [[setjmp.h]] no provoca que se invoquen las cláusulas y destructores **`__finally`**.

Una llamada a `setjmp` conserva el puntero de pila actual, los registros no volátiles y los registros MXCSR. Las llamadas a `longjmp` devuelven al sitio de la llamada a `setjmp` más reciente y restablecen el puntero de pila, los registros no volátiles y los registros MXCSR de nuevo al estado que conserva la llamada a `setjmp` más reciente.

# Microsoft x64 calling convention

Se sigue la convención de llamadas de Microsoft x64[21][22] en Windows y [UEFI](https://en.wikipedia.org/wiki/UEFI) prearranque (para [long mode](https://en.wikipedia.org/wiki/Long_mode) en x86-64). Los cuatro primeros argumentos se colocan en los registros. Esto significa ``RCX``, ``RDX``, ``R8``, ``R9`` (en ese orden) para enteros, ``struct`` o punteros, y ``XMM0``, ``XMM1``, ``XMM2``, ``XMM3`` para argumentos en coma flotante. Los argumentos añadidos se introducen en la pila (de derecha a izquierda). Los valores de retorno enteros (similares a x86) se devuelven en ``RAX`` si son de ``64 bits`` o menos. Los valores de retorno en coma flotante se devuelven en ``XMM0``. Los parámetros de menos de 64 bits no se extienden a cero; los bits altos no se ponen a cero.

Las estructuras y uniones con tamaños que coinciden con los enteros se pasan y devuelven como si fueran enteros. En caso contrario, se sustituyen por un puntero cuando se utilizan como argumento. Cuando se necesita devolver una estructura sobredimensionada, se antepone otro puntero a un espacio proporcionado por el llamante como primer argumento, desplazando todos los demás argumentos un lugar a la derecha[23].

Cuando se compila para la arquitectura x64 en un contexto Windows (tanto si se utilizan herramientas de Microsoft como si no), [[__stdcall]], [[__thiscall]], [[__cdecl]] y [[__fastcall]] se resuelven utilizando esta convención.

En la convención de llamadas de ``Microsoft x64``, es responsabilidad de quien llama asignar ``32 bytes`` de "[[shadow-spaces|espacio sombra]]" en la pila justo antes de llamar a la función (independientemente del número real de parámetros utilizados), y vaciar la pila después de la llamada. El espacio sombra se utiliza para rellenar ``RCX``, ``RDX``, ``R8`` y ``R9``,[24] pero debe estar disponible para todas las funciones, incluso aquellas con menos de cuatro parámetros.

Los registros ``RAX``, ``RCX``, ``RDX``, ``R8``, ``R9``, ``R10``, ``R11`` se consideran volátiles (guardados por el llamante)[25].

Los registros ``RBX``, ``RBP``, ``RDI``, ``RSI``, ``RSP``, ``R12``, ``R13``, ``R14`` y ``R15`` se consideran no volátiles (guardados por la llamada)[25].

Por ejemplo, una función que toma 5 argumentos enteros tomará del primero al cuarto en registros, y el quinto será empujado encima del espacio sombra. Así, cuando se entra en la función llamada, la pila estará compuesta por (en orden ascendente) la dirección de retorno, seguida por el espacio de sombra (``32 bytes``) seguido por el quinto parámetro.

En ``x86-64``, ``Visual Studio 2008`` almacena los números de coma flotante en ``XMM6`` y ``XMM7`` (así como de ``XMM8`` a ``XMM15``); en consecuencia, para ``x86-64``, las rutinas de lenguaje ensamblador escritas por el usuario deben conservar ``XMM6`` y ``XMM7`` (en comparación con ``x86``, donde las rutinas de lenguaje ensamblador escritas por el usuario no necesitaban conservar ``XMM6`` y ``XMM7``). En otras palabras, las rutinas de lenguaje ensamblador escritas por el usuario deben actualizarse para guardar/restaurar ``XMM6`` y ``XMM7`` antes/después de la función cuando se portan de ``x86`` a ``x86-64``.

A partir de ``Visual Studio 2013``, Microsoft introdujo la convención de llamada [[__vectorcall]] que amplía la convención ``x64``.
